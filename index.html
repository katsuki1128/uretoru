<!doctype html>
<html>
<head>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WNC5MKL');</script>
    <!-- End Google Tag Manager -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <script src="setting.js"></script>
    <title>ウレトルクイズ</title>

    <!-- CSS & Tailwind -->
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- fontAwesome -->
    <script src="https://kit.fontawesome.com/e6a146d4cb.js" crossorigin="anonymous"></script>

</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WNC5MKL" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!----------------------------------------------
    ⭐️タイトル
    ------------------------------------------------->
    <section class="bg-gray-200">
        <div class="flex flex-col items-center justify-center px-6 pt-8 pb-4 mx-auto">
            <div class="w-full bg-white rounded-lg shadow sm:max-w-3xl md:w-4/5 xl:p-0">
                <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
                    <div>
                        <img class="w-full h-15 mr-2" src="./img/uretoru_logo.png" alt="logo" />
                        <div class="text-center mt-4 mb-0 mr-2 ml-2">
                            <p class="text-lg">
                                ⭐️スタンプ飛ばして番組参加！⭐️<br>
                            </p>
                            <p class="text-lg">
                                ⭐️ A・Bは１回しか押せません ⭐️<br>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>
    <!-- スタンプ表示エリア -->
    <div id="stampWrapper">
        <div id="stampListContainer" class="stampContainer">
            <div class="image-wrapper"><img class="image" src="./img/a.png" data-id="a1"></div>
            <div class="image-wrapper"><img class="image" src="./img/b.png" data-id="a2"></div>
            <div class="image-wrapper"><img class="image" src="./img/e.png" data-id="b1"></div>
            <div class="image-wrapper"><img class="image" src="./img/f.png" data-id="b2"></div>
            <div class="image-wrapper"><img class="image" src="./img/c.png" data-id="a3"></div>
            <div class="image-wrapper"><img class="image" src="./img/d.png" data-id="a4"></div>
            <div class="image-wrapper"><img class="image" src="./img/g.png" data-id="b3"></div>
            <div class="image-wrapper"><img class="image" src="./img/h.png" data-id="b4"></div>
            <div class="image-wrapper"><img class="image" src="./img/e.png" data-id="a5"></div>
            <div class="image-wrapper"><img class="image" src="./img/gu.png" data-id="a6"></div>
            <div class="image-wrapper"><img class="image" src="./img/rain.png" data-id="b5"></div>
            <div class="image-wrapper"><img class="image" src="./img/sunny.png" data-id="b6"></div>
            <div class="image-wrapper"><img class="image" src="./img/choki.png" data-id="a7"></div>
            <div class="image-wrapper"><img class="image" src="./img/par.png" data-id="a8"></div>
            <div class="image-wrapper"><img class="image" src="./img/sunny_cloudy.png" data-id="b7"></div>
            <div class="image-wrapper"><img class="image" src="./img/snow.png" data-id="b8"></div>
        </div>
    </div>

    <!----------------------------------------------
    ⭐️技術提供について記載
    ------------------------------------------------->
    <section class="bg-gray-200">
        <div class="flex flex-col items-center justify-center px-6 pt-8 pb-4 mx-auto">
            <div class="w-full bg-white rounded-lg shadow sm:max-w-3xl md:w-4/5 xl:p-0">
                <div class="text-center text-sm m-4">
                        powerd by tvcha
                </div>
            </div>
        </div>
    </section>
    <!-- スタンプ表示エリア -->


    <script src="setting.js"></script>

    <script>
        //----------------------------------------
        // ▼スタンプの幅を設定
        //----------------------------------------

        window.addEventListener('resize', adjustImageWidth);

        function adjustImageWidth() {
            const deviceWidth = window.innerWidth;
            const itemWidth = deviceWidth / 4;
        

            // アイテムの幅が75px未満の場合に調整を開始
            if (itemWidth < 95) {
                const adjustedWidth = itemWidth * 0.8; // 80%
                const adjustedMargin = itemWidth * 0.1; // 10%
                console.log("adjustedWidth",adjustedWidth);

                document.querySelectorAll('.image').forEach(img => {
                    img.style.width = `${adjustedWidth}px`;
                    img.style.marginLeft = `${adjustedMargin}px`;
                    img.style.marginRight = `${adjustedMargin}px`;
                });
            } else {
                // 95px以上の場合は初期のスタイルを適用
                document.querySelectorAll('.image').forEach(img => {
                    img.style.width = '75px';
                    img.style.marginLeft = '10px';
                    img.style.marginRight = '10px';
                });
            }
        }

        // 初期ロード時にも調整を行う
        adjustImageWidth();

        //----------------------------------------
        // ▼スタンプをクリックしたときの関数
        //----------------------------------------

        let isClickDisabled = false; // クリック無効フラグ

        const elements = document.querySelectorAll('.image');
        elements.forEach((element, index) => {
            element.addEventListener('click', function () {

                //----------------------------------------
                // ▼一度クリックされたらクリック不可にする
                //----------------------------------------
                // isClickDisabledを確認して、クリックが無効なら処理を終了
                if (isClickDisabled) {
                    return;
                }

                //----------------------------------------
                // ▼クリックされたらclassにclicked-imageを付与してCSSでアニメーション
                //----------------------------------------

                element.classList.add('clicked-image'); // クリックされたら 'clicked-image' クラスを追加
                isClickDisabled = true; // クリックを無効化

                // if (element.getAttribute('data-id').startsWith('a')) {
                //     const bElements = document.querySelectorAll('[data-id="b1"], [data-id="b2"], [data-id="b3"], [data-id="b4"]');
                //     // clickDisabledクラスを追加

                // const validIds = ['a1', 'a2', 'b1', 'b2', 'a3', 'a4', 'b3', 'b4'];

                // if (validIds.includes(element.getAttribute('data-id'))) {
                //     const allElements = document.querySelectorAll('[data-id="a1"], [data-id="a2"], [data-id="b1"], [data-id="b2"], [data-id="a3"], [data-id="a4"], [data-id="b3"], [data-id="b4"]');

                //     allElements.forEach((targetElement) => {
                //         targetElement.classList.add('never-clickabledisabled');
                //     });
                // }

                //----------------------------------------
                // // クリックされていないスタンプの透明度を50 % に設定
                //----------------------------------------
                elements.forEach((otherImageElement, otherIndex) => {
                    if (otherIndex !== index) {
                        otherImageElement.style.opacity = '0.5';
                        // console.log(otherImageElement);
                        setTimeout(() => {
                            otherImageElement.style.opacity = '1'; // 5秒後に透明度を元に戻す
                        }, 5000);
                    }
                });

                //console.log(element)

                //----------------------------------------
                // ▼クリックされたスタンプのIDを取得する関数
                //----------------------------------------
                // クリックされた画像のデータ属性を取得
                const id = element.dataset.id;
                // 取得データ格納配列を生成
                const data = {};
                data.id = id;
                // 配列をJSONデータに変換
                const jsonString = JSON.stringify(data);
                const jsonData = JSON.parse(jsonString);
                stickers(jsonData, element);
            });

        });

        const removeClickedImageAndEnableClick = (element) => {
            element.classList.remove('clicked-image'); // 一定時間経過後に 'clicked-image' クラスを削除
            isClickDisabled = false; // 一定時間後にクリックを再度有効にする
        };

        const stickers = async (param, element) => {
            const params = { method: "post", body: JSON.stringify(param) };
            await fetch("https://santaclaus.fbs.co.jp/assets/lib/MentaiStickers.php", params)
            .then((response) => response.json())
            .then((data) => {
            // 非同期処理が成功した場合
            const code = data[0].Code;
            switch (code) {
                case 1:
                    setTimeout(() => {
                        removeClickedImageAndEnableClick(element);
                    }, 5000);
                    break;
                case 2:
                    break;
                case 3:
                    break;
                default:
                    break;
            }
            //console.log(param)
            })
            .catch((error) => {
                // 非同期処理が失敗した場合
            })
        }
    </script>

</body>
</html>